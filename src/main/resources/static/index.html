<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>EduSmart Portal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <style>
        body { background-color: #f5faff; font-family: 'Segoe UI', sans-serif; }
        .navbar { background-color: #e3f2fd !important; }
        .hero { background-color: #fff; padding: 4rem 2rem; border-radius: 20px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.05); }
        .hero h1 { font-size: 3rem; margin-bottom: 1rem; color: #0077b6; }
        .card:hover { transform: translateY(-5px); transition: 0.3s; }
    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-light bg-light px-4">
    <div class="container-fluid">
        <div class="collapse navbar-collapse" id="navbar-links">
            <div class="ms-auto" id="nav-buttons"></div>
        </div>
    </div>
</nav>

<div class="container py-5">
    <div class="hero mb-5">
        <h1>Welcome to EduSmart</h1>
    </div>

    <h2 class="text-primary mb-4 text-center">All Available Courses</h2>
    <div id="courses" class="row g-4 justify-content-center">
        <p class="text-muted text-center">Loading courses...</p>
    </div>
</div>

<script src="js/api.js"></script>
<script>
    async function getCurrentUserSafe() {
        try {
            return await apiFetch("/current-user");
        } catch {
            return null;
        }
    }

    async function loadCourses() {
        const coursesDiv = document.getElementById("courses");
        try {
            const courses = await apiFetch("/getAllCourses");
            if (!courses || courses.length === 0) {
                coursesDiv.innerHTML = `<p class="text-muted text-center">No courses available yet.</p>`;
                return;
            }

            coursesDiv.innerHTML = courses.map(course => `
                <div class="col-md-4">
                    <div class="card shadow-sm h-100">
                        <div class="card-body">
                            <h5 class="card-title text-primary">${course.title}</h5>
                            <p class="card-text">${course.description}</p>
                            <button class="btn btn-outline-primary" onclick="viewCourse('${encodeURIComponent(course.title)}')">
                                View Details
                            </button>
                        </div>
                    </div>
                </div>
            `).join("");
        } catch (err) {
            coursesDiv.innerHTML = `<p class="text-danger text-center">Failed to load courses.</p>`;
        }
    }

    function viewCourse(title) {
        window.location.href = `course.html?title=${title}`;
    }

    document.addEventListener("DOMContentLoaded", async () => {
        const navButtons = document.getElementById("nav-buttons");
        const user = await getCurrentUserSafe();

        let links = `
            <a href="login.html" class="btn btn-outline-primary me-2">Login</a>
            <a href="register.html" class="btn btn-outline-success me-2">Register</a>
        `;

        if (user && user.role) {
            const role = user.role.toUpperCase();
            links = `<a href="profile.html" class="btn btn-outline-primary me-2">Profile</a>`;
            links += `<a href="forum.html" class="btn btn-outline-info me-2">Forum</a>`;
            if (role === "ADMIN") links += `<a href="admin.html" class="btn btn-outline-danger me-2">Admin</a>`;
            if (role === "STUDENT") links += `<a href="student.html" class="btn btn-outline-success me-2">Student</a>`;
            if (role === "STUDENT") links += `<a href="quiz.html" class="btn btn-outline-success me-2">Quiz</a>`;
            if (role === "PROFESSOR") links += `<a href="professor.html" class="btn btn-outline-warning me-2">Professor</a>`;
            links += `<button onclick="logout()" class="btn btn-outline-danger">Logout</button>`;
        }

        navButtons.innerHTML = links;

        await loadCourses();
    });
</script>
</body>
</html>
